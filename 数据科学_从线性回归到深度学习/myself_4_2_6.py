# -*- coding: UTF-8 -*-
"""
此脚本用于如何使用统计方法解决模型幻觉
"""

import numpy as np 
import statsmodels.api as sm 
import matplotlib.pyplot as plt 
import pandas as pd 

def generate_randomvar():
	np.random.seed(4873)
	#返回20个随机整数
	return np.random.randint(2,size=20)

def evuluate_model(res):
	print(res.summary())
	print('检验z的系数等于0')
	print(res.f_test('z=0'))
	print('检验建设的const的系数等于0')
	print(res.f_test('const=0'))
	print('检测假设z和const的系数同时等于0')
	print(res.f_test(['z=0','const=0']))

def train_model(x,y):
	model = sm.OLS(y,x)
	res = model.fit()
	return res 

def confidence_interval(data):
	features = ['x']
	labels = ['y']
#	features = data['x']
#	labels = data['y']
	Y = data[labels]
	_X = data[features]
#	yy = data[labels]
#	xx = data[features]
#	features应该是两列x，z
	_X['z'] = generate_randomvar()
#	为什么是往features add_constant
	X = sm.add_constant(_X)
	res = train_model(X,Y)
	evuluate_model(res)

def generate_data():
	np.random.seed(5320)
	x = np.array(range(0,20))/2
	error = np.round(np.random.randn(20),2)
	y = 0.05 * x + error
	z = np.zeros(20) + 1
	return pd.DataFrame({'x':x,'y':y,'z':z})

def wrong_coef():
	#特征x z，标签 z
#	features = ['x','z']
#	labels = ['y']
	features = ['x','z']
	labels = ['y']
	data = generate_data()
	x_shift = data[features]
	y_shift = data[labels]
	#查看一个变量和两个变量的模型报告
	model = sm.OLS(y_shift,x_shift['x'])
	res = model.fit()
	print('--------------没有加入新变量时---------------')
	print(res.summary())
	model_1 = sm.OLS(y_shift,x_shift)
	res_1 = model_1.fit()
	print('---------------加入新变量后------------------')
	print(res_1.summary())

def read_data(file):
	data = pd.read_csv(file)
	return data 

if __name__ == "__main__":
	data = read_data('simple_example.csv')
	print("**************************************************")
	print("加入不相关的新变量，新变量的系数被错误估计为不等于0")
	print("**************************************************")
	confidence_interval(data)
	print("**********************************************")
	print("加入不相关的新变量，旧变量系数的符号被错误估计")
	print("**********************************************")
	wrong_coef()






































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































